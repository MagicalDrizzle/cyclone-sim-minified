const SIMULATION_MODES=["Normal (Atlantic)","Hyper","Wild","Megablobs","Experimental","WPac"],SIM_MODE_NORMAL=0,SIM_MODE_HYPER=1,SIM_MODE_WILD=2,SIM_MODE_MEGABLOBS=3,SIM_MODE_EXPERIMENTAL=4,SIM_MODE_WPAC=5,SPAWN_RULES={0:function(e){random()<.01*sq((seasonalSine(e.tick)+1)/2)+.002&&e.spawn(!1,{x:random(0,WIDTH),y:random(.6*HEIGHT,.9*HEIGHT),sType:"l"}),random()<.01-.002*seasonalSine(e.tick)&&e.spawn(!0)},1:function(e){random()<.013*sq((seasonalSine(e.tick)+1)/2)+.002&&e.spawn(!1),random()<.01-.002*seasonalSine(e.tick)&&e.spawn(!0)},2:function(e){random()<.015&&e.spawn(!1,{x:random(0,WIDTH),y:random(.2*HEIGHT,.9*HEIGHT),sType:"l"}),random()<.01-.002*seasonalSine(e.tick)&&e.spawn(!0)},3:function(e){random()<.013*sq((seasonalSine(e.tick)+1)/2)+.002&&e.spawn(!1),random()<.01-.002*seasonalSine(e.tick)&&e.spawn(!0)}};SPAWN_RULES[4]=SPAWN_RULES[1],SPAWN_RULES[5]=function(e){random()<.0011&&e.spawn(!1,{x:random(.28*WIDTH,.73*WIDTH),y:random(.51*HEIGHT,.76*HEIGHT),sType:"l"}),random()<.0011&&e.spawn(!1,{x:random(.3*WIDTH,.73*WIDTH),y:random(.761*HEIGHT,.9*HEIGHT),sType:"l"}),random()<.0011&&e.spawn(!1,{x:random(.28*WIDTH,.73*WIDTH),y:random(.51*HEIGHT,.76*HEIGHT),sType:"l"}),random()<.0011&&e.spawn(!1,{x:random(.3*WIDTH,.73*WIDTH),y:random(.761*HEIGHT,.9*HEIGHT),sType:"l"}),random()<4e-4&&e.spawn(!1,{x:random(.731*WIDTH,.807*WIDTH),y:random(.511*HEIGHT,.787*HEIGHT),sType:"l"}),random()<4e-4&&e.spawn(!1,{x:random(.731*WIDTH,.807*WIDTH),y:random(.788*HEIGHT,.9*HEIGHT),sType:"l"}),random()<3e-4&&e.spawn(!1,{x:random(.667*WIDTH,.807*WIDTH),y:random(.445*HEIGHT,.509*HEIGHT),sType:"l"}),random()<1e-4&&e.spawn(!1,{x:random(.808*WIDTH,.98*WIDTH),y:random(.55*HEIGHT,.83*HEIGHT),sType:"l"}),random()<25e-5&&e.spawn(!1,{x:random(.145*WIDTH,.244*WIDTH),y:random(.648*HEIGHT,.84*HEIGHT),sType:"l"}),random()<1e-4&&e.spawn(!1,{x:random(.145*WIDTH,.244*WIDTH),y:random(.841*HEIGHT,.9*HEIGHT),sType:"l"}),random()<1e-4&&e.spawn(!1,{x:random(.115*WIDTH,.14*WIDTH),y:random(.667*HEIGHT,.695*HEIGHT),sType:"l"}),random()<5e-5&&e.spawn(!1,{x:random(.094*WIDTH,.14*WIDTH),y:random(.842*HEIGHT,.91*HEIGHT),sType:"l"}),random()<15e-5&&e.spawn(!1,{x:random(.182*WIDTH,.209*WIDTH),y:random(.62*HEIGHT,.649*HEIGHT),sType:"l"}),random()<15e-5&&e.spawn(!1,{x:random(.21*WIDTH,.239*WIDTH),y:random(.602*HEIGHT,.649*HEIGHT),sType:"l"}),random()<15e-5&&e.spawn(!1,{x:random(.24*WIDTH,.269*WIDTH),y:random(.56*HEIGHT,.635*HEIGHT),sType:"l"}),random()<2e-4&&e.spawn(!1,{x:random(.245*WIDTH,.269*WIDTH),y:random(.636*HEIGHT,.685*HEIGHT),sType:"l"}),random()<2e-4&&e.spawn(!1,{x:random(.266*WIDTH,.301*WIDTH),y:random(.761*HEIGHT,.852*HEIGHT),sType:"l"}),random()<15e-5&&e.spawn(!1,{x:random(.245*WIDTH,.265*WIDTH),y:random(.761*HEIGHT,.9*HEIGHT),sType:"l"}),random()<.01-.002*seasonalSine(e.tick)&&e.spawn(!0)};const ENV_DEFS={};function randf(e,o){return Math.random()*(o-e)+e}ENV_DEFS.defaults={},ENV_DEFS[0]={},ENV_DEFS[1]={},ENV_DEFS[2]={},ENV_DEFS[3]={},ENV_DEFS[4]={},ENV_DEFS[5]={},ENV_DEFS.defaults.jetstream={version:0,mapFunc:(e,o,a,r)=>{let n=e.noise(0,o-3*r,0,r),s=e.modifiers.highJet,i=e.yearfrac(r),m=map(sqrt(map(i,-1,1,0,1)),0,1,s?.47:.55,s?.25:.35),p=map(i,-1,1,s?.45:.5,s?.25:.35);return(m+(n=map(n,0,1.5,-p,p)))*HEIGHT},invisible:!0,noiseChannels:[[4,.5,160,300,1,2]]},ENV_DEFS[0].jetstream={},ENV_DEFS[1].jetstream={modifiers:{highJet:!0}},ENV_DEFS[2].jetstream={mapFunc:(e,o,a,r)=>{let n=e.noise(0,o-3*r,0,r),s=e.yearfrac(r),i=e.piecewise(s,[[1,.65],[2.5,-.15],[10,-.15],[11.5,.65]]),m=e.piecewise(s,[[.5,.3],[1.75,.7],[3,.2],[9.5,.2],[10.75,.7],[12,.3]]);return(i+(n=map(n,0,1,-m,m)))*HEIGHT}},ENV_DEFS[3].jetstream={modifiers:{highJet:!0}},ENV_DEFS[4].jetstream={},ENV_DEFS[5].jetstream={},ENV_DEFS.defaults.LLSteering={version:0,mapFunc:(e,o,a,r)=>{e.vec.set(1);let n=e.field("jetstream"),s=map(cos(map(a,0,HEIGHT,0,PI)),-1.25,.5,.5,0),i=constrain(4*pow(1-s+map(e.noise(0),0,1,-.3,.3)+map(n,0,HEIGHT,-.3,.3),2),0,4),m=constrain(e.noise(1)+map(n,0,HEIGHT,.5,-.5),0,1),p=constrain(3*pow(.3+s+map(m,0,1,-.1,.3),2),0,3),l=map(s,.9,1,511*PI/512,15.75*PI/16),E=map(e.noise(3),0,1,0,4*TAU),t=pow(2.5,map(e.noise(3),4,4,4,4));return e.vec.rotate(E),e.vec.mult(t),e.vec.add(i+p*cos(l),p*sin(l)),e.vec},vector:!0,magMap:[0,3,0,16],noiseChannels:[[4,.5,80,100,1,3],"","",[4,.5,170,300,1,3]]},ENV_DEFS[0].LLSteering={},ENV_DEFS[1].LLSteering={},ENV_DEFS[2].LLSteering={mapFunc:(e,o,a,r)=>{e.vec.set(1);let n=e.yearfrac(r),s=e.piecewise(n,[[1,3],[2.5,1],[4.5,.5],[6,.75],[7.5,.65],[7.75,.05],[8,1.1],[10,1.8],[11,3]]),i=e.piecewise(n,[[1,13*PI/8],[2.5,9*PI/8],[4.5,PI],[6,17*PI/16],[7.5,17*PI/16],[8,31*PI/16],[10,15*PI/8],[11.5,13*PI/8]]),m=map(e.noise(3),0,1,0,4*TAU),p=pow(1.5,map(e.noise(2),0,1,-3,4));return e.vec.rotate(m),e.vec.mult(p),e.vec.add(s*cos(i),s*sin(i)),e.vec}},ENV_DEFS[3].LLSteering={},ENV_DEFS[4].LLSteering={},ENV_DEFS[5].LLSteering={},ENV_DEFS.defaults.ULSteering={version:0,mapFunc:(e,o,a,r)=>{e.vec.set(1);let n=e.noise(1),s=seasonalSine(r),i=e.field("jetstream"),m=e.field("jetstream",o+10),p=abs(a-i),l=pow(2,3-p/40),E=pow(.7,l),t=atan((m-i)/10)+map(a-i,-50,50,PI/4,-PI/4,!0),T=a>i?pow(1.7,map(t,-PI/2,PI/2,3,-5))*pow(.7,p/20)*E:0,d=-PI/16,S=.45-i/HEIGHT-map(sqrt(map(s,-1,1,0,1)),0,1,.15,0),c=(map(S,-.3,.25,e.modifiers.hadleyUpperBound,1.5,!0)+map(n,0,1,-1.5,1.5))*E*(a>i?1:0),H=map(S,-.3,.25,-PI/16,-15*PI/16,!0),I=2*E*(a<i?1:0),D=5*PI/8,f=map(e.noise(0),0,1,0,4*TAU);return n=pow(1.5,map(n,0,1,-8,4))*E,e.vec.rotate(f),e.vec.mult(n),e.vec.add(l*cos(t),l*sin(t)),e.vec.add(T*cos(d),T*sin(d)),e.vec.add(c*cos(H),c*sin(H)),e.vec.add(I*cos(D),I*sin(D)),e.vec},vector:!0,magMap:[0,8,0,25],modifiers:{hadleyUpperBound:5},noiseChannels:[[4,.5,180,300,1,2],[4,.5,90,100,1,3]]},ENV_DEFS[0].ULSteering={},ENV_DEFS[1].ULSteering={modifiers:{hadleyUpperBound:3}},ENV_DEFS[2].ULSteering={mapFunc:(e,o,a,r)=>{e.vec.set(1);let n=e.noise(1),s=e.yearfrac(r),i=e.field("jetstream"),m=e.field("jetstream",o+10),p=abs(a-i),l=pow(2,3-p/30),E=pow(.7,l),t=atan((m-i)/10)+map(a-i,-50,50,PI/15,-PI/17,!0),T=e.piecewise(s,[[1,4.5],[2.5,1.2],[4,.5],[4.5,1.7],[5,.6],[6.5,.65],[7.5,.65],[7.75,.05],[8,1.3],[9,1.7],[10,2.3],[11.5,4.5]])*E*(a>i?1:0),d=e.piecewise(s,[[1,11*PI/8],[2.5,9*PI/8],[4,17*PI/16],[4.5,11*PI/8],[5,17*PI/16],[6.5,35*PI/32],[7.5,17*PI/16],[8,31*PI/16],[9,15*PI/8],[10,7*PI/4],[10.5,11*PI/8]]),S=2*E*(a<i?map(i-a,0,400,1,0,!0):0),c=5*PI/8,H=map(e.noise(0),0,1,0,4*TAU);return n=pow(1.5,map(n,0,1,-3,4))*E,e.vec.rotate(H),e.vec.mult(n),e.vec.add(l*cos(t),l*sin(t)),e.vec.add(T*cos(d),T*sin(d)),e.vec.add(S*cos(c),S*sin(c)),e.vec}},ENV_DEFS[3].ULSteering={},ENV_DEFS[4].ULSteering={},ENV_DEFS[5].ULSteering={modifiers:{hadleyUpperBound:5}},ENV_DEFS.defaults.shear={version:0,mapFunc:(e,o,a,r)=>{let n=e.field("LLSteering"),s=e.field("ULSteering");return e.vec.set(s),e.vec.sub(n),e.vec},vector:!0,noVectorFlip:!0,magMap:[0,8,0,25]},ENV_DEFS[0].shear={},ENV_DEFS[1].shear={},ENV_DEFS[2].shear={},ENV_DEFS[3].shear={},ENV_DEFS[4].shear={},ENV_DEFS[5].shear={},ENV_DEFS.defaults.SSTAnomaly={version:0,mapFunc:(e,o,a,r)=>{let n,s=e.noise(0),i=(s*=2)<1?-1:1;return 0===(s=1-abs(1-s))&&(s=1e-6),s=log(s),s*=-(n=void 0!==e.modifiers.r?e.modifiers.r:map(a,0,HEIGHT,3,6)),s*=i,void 0!==e.modifiers.bigBlobBase&&s>e.modifiers.bigBlobExponentThreshold&&(s+=pow(e.modifiers.bigBlobBase,s-e.modifiers.bigBlobExponentThreshold)-1),s},hueMap:e=>{colorMode(HSB);let o,a=color(240,100,70),r=color(0,100,70),n=color(240,1,90),s=color(0,1,90);return o=e<0?lerpColor(a,n,map(e,-5,0,0,1)):lerpColor(s,r,map(e,0,5,0,1)),colorMode(RGB),o},oceanic:!0,noiseChannels:[[6,.5,150,3e3,.05,1.5]]},ENV_DEFS[0].SSTAnomaly={},ENV_DEFS[1].SSTAnomaly={},ENV_DEFS[2].SSTAnomaly={modifiers:{r:5,bigBlobBase:1.4,bigBlobExponentThreshold:1.5}},ENV_DEFS[3].SSTAnomaly={modifiers:{r:7,bigBlobBase:1.8,bigBlobExponentThreshold:1}},ENV_DEFS[4].SSTAnomaly={},ENV_DEFS[5].SSTAnomaly={mapFunc:(e,o,a,r)=>{let n,s=e.noise(0),i=(s*=1.8)<1?-.5:1;return 0===(s=1-abs(1-s))&&(s=1e-6),s=log(s),s*=-(n=void 0!==e.modifiers.r?e.modifiers.r:map(a,1,HEIGHT,3,6)),s*=i,void 0!==e.modifiers.bigBlobBase&&s>e.modifiers.bigBlobExponentThreshold&&(s+=pow(e.modifiers.bigBlobBase,s-e.modifiers.bigBlobExponentThreshold)-1),s}},ENV_DEFS.defaults.SST={version:0,mapFunc:(e,o,a,r)=>{if(a<0)return 0;let n=e.field("SSTAnomaly"),s=seasonalSine(r),i=map(cos(map(o,0,WIDTH,0,PI)),-1,1,1,1),m=a/HEIGHT,p=(sqrt(m)+m)/2,l=sqrt(sqrt(m)),E=map(cos(lerp(PI,0,lerp(p,l,sq(i)))),-1,1,0,1),t=e.modifiers.offSeasonPolarTemp,T=e.modifiers.peakSeasonPolarTemp,d=e.modifiers.offSeasonTropicsTemp,S=e.modifiers.peakSeasonTropicsTemp;return lerp(map(s,-1,1,t,T),map(s,-1,1,d,S),E)+n},hueMap:e=>{let o;return colorMode(HSB),o=e<10?lerpColor(color(240,1,100),color(240,100,70),map(e,0,10,0,1)):e<20?lerpColor(color(240,100,70),color(180,50,90),map(e,10,20,0,1)):e<26?lerpColor(color(180,50,90),color(120,100,65),map(e,20,26,0,1)):e<29?lerpColor(color(60,100,100),color(0,100,70),map(e,26,29,0,1)):e<34?lerpColor(color(359,100,70),color(300,5,100),map(e,29,34,0,1)):e<40?lerpColor(color(300,5,100),color(150,10,90),map(e,34,40,0,1)):e<50?lerpColor(color(150,10,90),color(150,60,75),map(e,40,50,0,1)):e<75?lerpColor(color(30,90,90),color(30,30,90),map(e,50,75,0,1)):e<150?lerpColor(color(0,0,35),color(0,0,95),map(e,75,150,0,1)):lerpColor(color(0,0,25),color(0,0,95),map(e%150,0,150,0,1)),colorMode(RGB),o},oceanic:!0,modifiers:{offSeasonPolarTemp:-3,peakSeasonPolarTemp:0,offSeasonTropicsTemp:25,peakSeasonTropicsTemp:28}},ENV_DEFS[0].SST={},ENV_DEFS[1].SST={modifiers:{offSeasonPolarTemp:5,peakSeasonPolarTemp:20,offSeasonTropicsTemp:31,peakSeasonTropicsTemp:35}},ENV_DEFS[2].SST={mapFunc:(e,o,a,r)=>{if(a<0)return 0;let n=e.field("SSTAnomaly"),s=e.yearfrac(r);return e.piecewise(s,[[0,22],[2,25.5],[4,25],[5,26.5],[6,27],[6.25,30],[6.75,31],[7,28],[9,27],[10,26],[11,23]])+n}},ENV_DEFS[3].SST={modifiers:{offSeasonPolarTemp:-5,peakSeasonPolarTemp:20,offSeasonTropicsTemp:23,peakSeasonTropicsTemp:28.5}},ENV_DEFS[4].SST={modifiers:{offSeasonPolarTemp:-15,peakSeasonPolarTemp:25,offSeasonTropicsTemp:0,peakSeasonTropicsTemp:75}},ENV_DEFS[5].SST={mapFunc:(e,o,a,r)=>{if(a<0)return 0;let n=e.field("SSTAnomaly"),s=seasonalSine(r),i=map(cos(map(o,0,WIDTH,0,PI)),0,.8,.8,.8),m=a/HEIGHT,p=(sqrt(m)+m)/3.25,l=1.25*sqrt(sqrt(m)),E=map(cos(lerp(PI,0,lerp(p,l,sq(i)))),-1,1,0,1),t=e.modifiers.offSeasonPolarTemp,T=e.modifiers.peakSeasonPolarTemp,d=e.modifiers.offSeasonTropicsTemp,S=e.modifiers.peakSeasonTropicsTemp;return lerp(map(s,-1,1,t,T),map(s,-1,1,d,S),E)+n},modifiers:{peakSeasonPolarTemp:0,offSeasonPolarTemp:-3,offSeasonTropicsTemp:27,peakSeasonTropicsTemp:29.5}},ENV_DEFS.defaults.moisture={version:0,mapFunc:(e,o,a,r)=>{let n=e.noise(0),s=seasonalSine(r),i=land.get(o,e.basin.hemY(a)),m=e.modifiers.polarMoisture,p=e.modifiers.tropicalMoisture,l=e.modifiers.mountainMoisture,E=map(i,.5,.7,map(a,0,HEIGHT,m,p),l,!0);return E+=map(s,-1,1,-.08,.08),E+=map(n,0,1,-.3,.3),E=constrain(E,0,1)},hueMap:e=>{let o;return colorMode(HSB),o=e<.5?lerpColor(color(45,100,30),color(45,1,90),map(e,0,.5,0,1)):lerpColor(color(180,1,90),color(180,100,30),map(e,.5,1,0,1)),colorMode(RGB),o},modifiers:{polarMoisture:.43,tropicalMoisture:.62,mountainMoisture:.2},noiseChannels:[[4,.5,120,120,.3,2]]},ENV_DEFS[0].moisture={},ENV_DEFS[1].moisture={modifiers:{polarMoisture:.52,tropicalMoisture:.62,mountainMoisture:.3}},ENV_DEFS[2].moisture={mapFunc:(e,o,a,r)=>{let n=e.noise(0),s=e.yearfrac(r),i=land.get(o,e.basin.hemY(a)),m=e.piecewise(s,[[.5,.35],[2,.55],[4,.6],[5.75,.58],[6,.1],[7,.2],[7.25,.6],[8.5,.72],[10,.55],[11.5,.35]]),p=e.modifiers.mountainMoisture,l=map(i,.5,.7,m,p,!0);return l+=map(n,0,1,-.3,.3),l=constrain(l,0,1)}},ENV_DEFS[3].moisture={},ENV_DEFS[4].moisture={},ENV_DEFS[5].moisture={modifiers:{polarMoisture:.45,tropicalMoisture:.75,mountainMoisture:0}};